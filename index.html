<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Weekly Meal Cost App</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.tailwindcss.com"></script>
<script src="copyasimage.js"></script>
<script src="calculator.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="recipes.js"></script>
<script src="recipesPanel.js"></script>
</head>
<body>
<!--Container -->
<div class="mx-auto bg-grey-400">
  <div class="min-h-screen flex flex-col">
    <!--Header Section Starts Here-->
    <header class="bg-primary fixed top-0 left-0 w-full z-50 h-16 flex items-center justify-between px-4">
      <p class="text-xl font-bold text-white">Weekly Meal Cost Computation</p>
      <div class="flex items-center gap-2">
        <button class="bg-blue-600 hover:bg-blue-700 text-white border-2 border-blue-600 font-bold py-2 px-4 rounded" onclick="captureAndCopy()">
          <i class="fa-solid fa-copy mr-2"></i>Copy as Image
        </button>
        <button class="bg-white text-primary border-2 border-white bg-hover font-bold py-2 px-4 rounded" onclick="sidebarToggle()">
          <i class="fa-solid fa-book-open mr-2"></i>Recipes
        </button>
      </div>
    </header>
    <!--/Header-->
    <!--Main-->
   <div class="flex pt-16">
     <main id="mainContent" class="transition-all duration-300 mr-64 p-4 overflow-auto h-[calc(100vh-4rem)]">
        <div class="flex flex-col">
          <div class="flex flex-1  flex-col md:flex-row lg:flex-row mx-2">
            <div class="mb-2 border border-primary rounded border shadow-sm w-full">
              <div class="bg-primary px-2 py-3 border-solid flex items-center justify-between">
                <p class="text-xl font-bold leading-tight tracking-tight text-white md:text-xl">
                  Meal
                </p>
                <button class="bg-white text-primary border-2 border-white bg-hover font-bold py-2 text-xs px-4 rounded" onclick="openDebtModal()">
                  <i class="fa-solid fa-plus-circle mr-2"></i>Add Additional Debt
                </button>
              </div>
              <div class="flex flex-wrap m-1">
                <!-- First div -->
                <div class="w-full md:w-1/3 px-3 mb-6">
                  <div class="w-full p-3 bg-white border border-primary rounded">
                    <div class="w-full max-w-lg mx-auto md:mx-0 p-3">
                      <div class="flex flex-wrap -mx-3 mb-6">
                        <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                          <label for="personCount" class="text-primary text-xl font-semibold relative top-2 ml-1 px-1 bg-white w-fit">Persons:</label>
                          <div class="flex mt-2">
                            <input id="personCount" type="number" class="border-2 border-primary rounded-l-[5px] px-3 py-2 text-xl w-full" value="5">
                            <button onclick="setPeople()" class="bg-hover bg-primary text-white px-4 py-2 rounded-r-[5px]">
                              <i class="fa-solid fa-check mr-2"></i>Set
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="flex flex-wrap -mx-3 mb-6">
                        <div id="peopleInputs" class="w-full md:w-1/2 px-3 mb-6 md:mb-0">

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Second div -->
                <div class="w-full md:w-1/3 px-3 mb-6">
                  <div class="w-full p-3 bg-white border border-primary rounded">
                    <div class="flex flex-wrap -mx-3 mb-6">
                  <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <label for="mealName" class="text-primary text-xl font-semibold relative top-2 ml-1 px-1 bg-white w-fit">Meal:</label>
                    <input oninput="loadRecipe()" id="mealName" type="text" class="border-2 border-primary rounded-[5px] px-3 py-2 text-xl w-full">
                  </div>
                  <div class="w-full md:w-1/2 px-3">
                    <label for="mealDay" class="text-primary text-xl font-semibold relative top-2 ml-1 px-1 bg-white w-fit">Day:</label>
                    <select id="mealDay" name="mealDay" class="border-2 border-primary rounded-[5px] px-3 py-2 text-xl w-full bg-transparent focus:outline-none">
                      <option>Sun-Mon</option>
                      <option>Mon-Tue</option>
                      <option>Tue-Wed</option>
                      <option>Wed-Thu</option>
                      <option>Thu-Fri</option>
                      <option>Fri-Sat</option>
                      <option>Sat-Sun</option>
                    </select>
                  </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                  <div class="w-full px-3">
                    <label class="text-primary text-xl font-semibold mb-2">Ingredients:</label>
                    <div id="ingredients" class="flex flex-col gap-2"></div>
                    <button id="addIngredientBtn" onclick="addIngredientRow()" class="bg-primary text-white px-4 py-2 rounded-[5px] text-sm w-full mt-2 bg-hover">
                      <i class="fa-solid fa-plus mr-2"></i>Add Ingredient
                    </button>
                    <div id="ingredientTemplate" class="hidden">
                      <div class="ingredientRow flex flex-col md:flex-row w-full gap-2">
                        <div class="flex flex-col w-full">
                          <label class="text-primary text-xl font-semibold mb-1">Name:</label>
                          <input class="ingName border-4 border-black rounded-[5px] px-3 py-2 text-xl w-full bg-transparent focus:outline-none placeholder:text-black/25" type="text" placeholder="Ingredient name">
                        </div>
                        <div class="flex flex-col w-full">
                          <label class="text-primary text-xl font-semibold mb-1">Price:</label>
                          <input class="ingPrice border-4 border-black rounded-[5px] px-3 py-2 text-xl w-full bg-transparent focus:outline-none placeholder:text-black/25" type="number" placeholder="Price">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                </div>
                </div>

                <!-- Third div -->
                <div class="w-full md:w-1/3 px-3 mb-6">
                  <div class="w-full p-3 bg-white border border-primary rounded">
                    <div class="flex flex-wrap mx-3 mb-6">
                      <div class="w-full px-3" id="whoWillEat">
                        <h4>Who will eat this meal:</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="flex flex-wrap m-1">
                <button onclick="addMeal()" class="bg-primary w-full text-white  px-2 py-2 rounded-[5px] text-xl m-2 bg-hover">
                  <i class="fa-solid fa-plus mr-2"></i>Add Meal
                </button>
              </div>
              <!--table-->
              <div class="w-screen max-w-full overflow-x-auto p-2 sm:px-4">
                <table id="mealTable" class="w-full border border-primary border-collapse text-sm bg-white">
                  <thead>
                    <tr>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Day</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Meal</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Ingredients Breakdown</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Total Price</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Per Meal Portion</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700">Breakdown</th>
                      <th class="border border-primary px-4 py-3 font-semibold text-gray-700 text-center">Action</th>
                    </tr>
                  </thead>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col">
          <div class="flex flex-1  flex-col md:flex-row lg:flex-row mx-2">
            <div class="mb-2 border border-primary rounded border shadow-sm w-full">
              <div class="bg-primary px-2 py-3 border-solid">
                  <p class="text-xl font-bold leading-tight tracking-tight text-white md:text-xl">Settlement</p>
              </div>
              <div class="flex flex-col md:flex-row gap-4 p-4 bg-white">
                <!-- Who Pays -->
                <div class="flex flex-col border border-primary rounded shadow-sm p-3 w-full md:w-1/4" id="whoPaysSection">
                  <div class="flex items-center justify-between mb-2">
                    <h3 class="font-bold text-lg text-primary m-0">Who Pays</h3>
                    <div class="relative">
                        <button id="togglePayerCalcBtn" onclick="togglePayerCalculator()" class="bg-white text-primary border-2 border-white bg-hover font-bold py-1 px-3 rounded"><i class="fa-solid fa-calculator mr-2"></i>Calc</button>
                      <div id="payerCalculator" class="hidden tooltip" aria-hidden="true">
                        <div class="calc-display">
                          <input id="calcDisplay" type="text" readonly value="0" />
                        </div>
                        <div class="calc-grid">
                          <button onclick="appendCalc('7')">7</button>
                          <button onclick="appendCalc('8')">8</button>
                          <button onclick="appendCalc('9')">9</button>
                          <button onclick="appendCalc('/')">/</button>

                          <button onclick="appendCalc('4')">4</button>
                          <button onclick="appendCalc('5')">5</button>
                          <button onclick="appendCalc('6')">6</button>
                          <button onclick="appendCalc('*')">*</button>

                          <button onclick="appendCalc('1')">1</button>
                          <button onclick="appendCalc('2')">2</button>
                          <button onclick="appendCalc('3')">3</button>
                          <button onclick="appendCalc('-')">-</button>

                          <button onclick="appendCalc('0')">0</button>
                          <button onclick="appendCalc('.')">.</button>
                          <button onclick="evaluateCalc()">=</button>
                          <button onclick="appendCalc('+')">+</button>

                          <button onclick="clearCalc()" class="span-2">C</button>
                          <button onclick="setCalcToTotal()">Use Total</button>
                        </div>
                        <div class="calc-actions">
                          <select id="payerSelect" class="px-2 py-1"></select>
                          <button onclick="applyCalcToSelected()" class="bg-primary text-white px-3 py-1 rounded">Apply</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="payerInputs" class="flex flex-col gap-2"></div>
                  <button onclick="computePayment()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded mt-3">
                    <i class="fa-solid fa-calculator mr-2"></i>Compute Payment
                  </button>
                </div>

                <!-- Contributions -->
                <div class="flex flex-col border border-primary rounded shadow-sm p-3 w-full md:w-1/4">
                  <h3 class="font-bold text-lg text-primary mb-2">Contributions</h3>
                  <div id="contributionsList" class="flex flex-col gap-1"></div>
                </div>

                <!-- Amount Owed Based on Meals -->
                <div class="flex flex-col border border-primary rounded shadow-sm p-3 w-full md:w-1/4">
                  <h3 class="font-bold text-lg text-primary mb-2">Breakdown</h3>
                  <div id="amountOwedList" class="flex flex-col gap-1"></div>
                </div>

                <!--  Settlement -->
                <div class="flex flex-col border border-primary rounded shadow-sm p-3 w-full md:w-1/4">
                  <h3 class="font-bold text-lg text-primary mb-2">Settlement</h3>
                  <div id="paymentResult"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <!--/Main-->
      <!--Recipe-->
      <aside id="sidebar" class="bg-recipe w-64 border-l-4 border-primary fixed top-16 right-0 h-[calc(100vh-4rem)] overflow-y-auto transition-all duration-300">
        <!-- Sticky Header -->
        <div class="sticky top-0 z-10 bg-white shadow-sm">
          <p class="text-xl font-bold text-primary px-3 py-2 m-0">Recipes</p>
          <form class="w-full max-w-sm px-3 py-2 bg-transparent m-0">
            <div class="flex items-center border-b border-primary py-2">
              <input class="appearance-none bg-transparent border-none w-full text-gray-700 mr-3 py-1 px-2" type="text" placeholder="Search Recipe" id="recipeSearch">
            </div>
          </form>
        </div>

        <!-- Recipe List -->
        <ul id="recipeList">
        </ul>
      </aside>
      <!--/Recipe-->
    </div>
  </div>
</div>

<!-- DEBT MODAL -->
<div id="debtModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl p-6 relative max-h-[80vh]">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold">Add Additional Debt</h3>
      <button onclick="closeDebtModal()" aria-label="Close" class="text-gray-500 hover:text-gray-800 text-2xl leading-none"><i class="fa-solid fa-xmark text-2xl"></i></button>
    </div>
    <div id="debtRows" class="flex flex-col gap-2 max-h-96 overflow-y-auto border rounded p-2"></div>
    <div class="flex justify-between items-center mt-6">
      <button onclick="addDebtRow()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Item</button>
      <div class="flex gap-2">
        <button onclick="closeDebtModal()" class="bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
        <button onclick="saveDebts()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Save Debts</button>
      </div>
    </div>
  </div>
</div>
<!-- DEBT MODAL -->

<!-- TOAST ERROR -->
<div id="validationToast" class="fixed inset-x-0 bottom-0 z-50 p-4 hidden">
  <div class="flex items-center justify-between rounded border border-red-400 bg-red-100 px-4 py-2 text-red-900 dark:border-red-700 dark:bg-red-800 dark:text-red-100">
    <span id="toastMessage" class="font-medium"></span>
    <button type="button" aria-label="Dismiss" class="rounded border border-red-300 bg-white p-1.5 shadow-sm transition-colors hover:bg-red-50 dark:border-red-600 dark:bg-gray-900 dark:hover:bg-gray-800" onclick="hideToast()">
      <i class="fa-solid fa-xmark w-5 h-5"></i>
    </button>
  </div>
</div>
<!-- TOAST ERROR -->
</body>
<script src="app.js"></script>
</html>
